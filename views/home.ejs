<html lang="en">
    <%- include('./partials/head.ejs') %>
<body>
    <%- include('./partials/nav.ejs') %>
    <div>
        <h2>FindDev API</h2>
        
        <div class="mb-3">
            <label for="basic-url" class="form-label">Find suitable developer now!</label>
            <div class="input-group">
              <select id="httpMethod" onchange="toggleJsonInput()">
                <option value="GET" selected>GET</option>
                <option value="POST">POST</option>
                <option value="PUT">PUT</option>
                <option value="DELETE">DELETE</option>
              </select>
              <span class="input-group-text" id="basic-addon3">https://finddev.com/api/</span>
              <input type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3 basic-addon4">
              <button onclick="sendData()" class="btn btn-outline-secondary" type="button" id="button-addon2">Send</button>
            </div>
            <div id="jsonInput" style="display:none;">
                <textarea id="jsonData" rows="1" cols="170"></textarea>
            </div>
        </div>
    </br>
        <!-- textarea to show fetched developers information in json format -->
        <form id="form" class="form-floating">
            <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 200px">
                <%= stringifiedDevs %>
            </textarea>
            <label for="floatingTextarea2">Result</label>
        </form>
    </br>
        <div class="bottom-icons">
            <i class="far fa-copy icon" onclick="copy()" title="Copy"></i>
            <i class="far fa-thumbs-up icon" title="Like"></i>
            <i class="far fa-thumbs-down icon" title="Dislike"></i>
        </div>
    </div>
    <%- include('./partials/footer.ejs') %>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <script>
        function toggleJsonInput() {
            const httpMethod = document.getElementById("httpMethod").value;
            const jsonInput = document.getElementById("jsonInput");
            jsonInput.style.display = httpMethod === "POST" ? "block" : "none";
        }
        function sendData() {
            const httpMethod = document.getElementById("httpMethod").value;
            const jsonData = document.getElementById("jsonData").value;
            const selectedIdToDelete = document.getElementById("basic-url").value;

            if (httpMethod === "POST") {
                fetch("/addDev", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: jsonData,
                })
                .then(response => response.json())
                .then(data => {
                    alert("Dev added successfully!")
                    window.location.href = "/";
                })
                .catch(error => console.error(`Error sending data ${error}`));
            } else if (httpMethod === "DELETE") {
                if (selectedIdToDelete) {
                    fetch(`/deleteDev/${selectedIdToDelete}`, {
                        method: "DELETE",
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert("Deleted Successfully!")
                        window.location.href = "/";
                    })
                    .catch(err => console.error(`Error deleting Dev: ${err}`));
                } else {
                    alert("Enter ID to delete!");
                }
            } else {
                alert("Unsupported HTTP method");
            }
        }
    </script>
</body>
</html>